{% extends 'base.html' %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="d-flex" style="min-height: 100vh;">
    <nav class="d-none d-md-flex flex-column flex-shrink-0 p-3 text-bg-dark" style="width: 280px;">
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item"><a href="#" class="nav-link active" aria-current="page">
                <svg class="bi pe-none me-2" width="16" height="16" aria-hidden="true">
                    <use xlink:href="#home"></use>
                </svg>
                Account Settings
            </a></li>
            <li><a href="#" class="nav-link disabled">
                <svg class="bi pe-none me-2 " width="16" height="16" aria-hidden="true">
                    <use xlink:href="#"></use>
                </svg>
                Notifications (Soon)
            </a></li>
            <li><a href="#" class="nav-link disabled">
                <svg class="bi pe-none me-2" width="16" height="16" aria-hidden="true">
                    <use xlink:href="#table"></use>
                </svg>
                Export Data (Soon)
            </a></li>
        </ul>
    </nav>

    <main class="flex-grow-1 container" style="padding-top: 50px; padding-bottom: 50px;">
        <button class="btn btn-secondary d-md-none mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#mobileSidebar" aria-expanded="false" aria-controls="mobileSidebar">
            â˜° Menu
        </button>

        <div class="collapse d-md-none mb-3" id="mobileSidebar">
            <div class="p-2 text-bg-dark">
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item"><a href="#" class="nav-link active" aria-current="page">Account Settings</a></li>
                    <li><a href="#" class="nav-link disabled">Notifications (Soon)</a></li>
                    <li><a href="#" class="nav-link disabled">Export Data (Soon)</a></li>
                </ul>
            </div>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show text-center mb-3"
             role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
        <h1 class="mb-4">Account Settings</h1>

        <div class="card mb-4">
            <div class="card-header">Change Name</div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('change_name',id=current_user.id) }}" id="changeNameForm">
                    <div class="mb-3">
                        <label for="nameInput" class="form-label">Name</label>
                        <input type="text" class="form-control" name="nameInput" id="nameInput" placeholder="Enter new name">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Name</button>
                </form>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">Change Email</div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('change_email',id=current_user.id) }}" id="changeEmailForm">
                    <div class="mb-3">
                        <label for="emailInput" class="form-label">Email address</label>
                        <input type="email" class="form-control" name="emailInput" id="emailInput" placeholder="Enter new email">
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" name="password" id="password" placeholder="Password">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Email</button>
                </form>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">Change Password</div>
            <div class="card-body">
                <form id="changePasswordForm">
                    <div class="mb-3">
                        <label for="currentPassword" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword" placeholder="Current password">
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="newPassword" placeholder="New password">
                    </div>
                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Password</button>
                </form>
            </div>
        </div>
        <button type="button" class="btn btn-danger"
                                                data-bs-toggle="modal"
                                                data-bs-target="#deleteModal{{ current_user.id }}"
                                                title="Delete">
                                            <i class="fas fa-trash"></i> Delete my account
                                        </button>
    </main>
</div>
<div class="modal fade" id="deleteModal{{ current_user.id }}" tabindex="-1"
     aria-labelledby="modalLabel{{ current_user.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <form method="POST" action="{{ url_for('delete_account',id=current_user.id) }}">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="modalLabel{{ current_user.id }}">
                        <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                        Confirm Account Deletion
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete your account? <br>
                       <strong>This action cannot be undone.</strong>
                    </p>
                    <div class="mb-3">
                        <label for="password" class="form-label">To confirm, please enter your password:</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Delete My Account
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


{% endblock %}
